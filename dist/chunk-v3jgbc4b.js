import{f as L,h as I,i as q,k as F,o as e,p as C,q as d,r as K,s as h,u as z}from"./chunk-ypwewzwb.js";import"./chunk-573s6t0s.js";e();var Q="PJv57W-body",R="PJv57W-container",X="PJv57W-download-button",Y="PJv57W-filename",Z="PJv57W-note",$="PJv57W-progress-bar",E="PJv57W-progress-bar-inner",U="PJv57W-title";var V=".PJv57W-body{color:#333;background-color:#f5f5f7;background-position:50%;background-repeat:no-repeat;background-size:cover;background-attachment:fixed;justify-content:center;align-items:center;height:100vh;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;display:flex}.PJv57W-container{text-align:center;background:#fff;border-radius:12px;max-width:600px;padding:20px;box-shadow:0 4px 10px #0000001a}.PJv57W-title{margin-bottom:20px;font-size:1.5rem}.PJv57W-filename{color:#555;word-wrap:break-word;margin-bottom:10px;font-size:1.2rem}.PJv57W-progress-bar{background:#e5e5e7;border-radius:5px;width:100%;height:10px;margin-top:20px;margin-bottom:20px;overflow:hidden}.PJv57W-progress-bar-inner{background:#007aff;width:0%;height:100%;transition:width .2s}.PJv57W-download-button{color:#fff;cursor:pointer;background:#007aff;border:none;border-radius:8px;padding:12px 24px;font-size:1rem;transition:background-color .3s}.PJv57W-download-button:disabled{cursor:not-allowed;background:#8e8e93}.PJv57W-download-button:hover:not(:disabled){background:#005bb5}.PJv57W-note{color:#666;min-height:20px;margin-top:10px;font-size:.85rem}";var A=async(o,p,W=131072,f=6)=>{let m=(await fetch(o,{method:"HEAD"})).headers.get("Content-Length");if(!m)throw new Error("无法获取文件大小");let r=parseInt(m,10),b=Math.ceil(r/W),v=new Array(b),x=0,H=Array.from({length:b},(P,G)=>{return async()=>{let w=G*W,J=Math.min(w+W-1,r-1),_=await fetch(o,{headers:{Range:`bytes=${w}-${J}`}});if(!_.ok&&_.status!==206)throw new Error(`分块下载失败：${_.status}`);let B=await _.arrayBuffer();v[G]=B,x+=B.byteLength,p(x/r*100)}});await(async(P,G)=>{let w=[...P],J=[];while(w.length>0){while(J.length<G&&w.length>0){let B=w.shift()().finally(()=>{J.splice(J.indexOf(B),1)});J.push(B)}await Promise.race(J)}await Promise.all(J)})(H,f);let N=new Uint8Array(r),O=0;for(let P of v){if(P.byteLength>W)return P;N.set(new Uint8Array(P),O),O+=P.byteLength}return N.buffer},T=(o)=>{return typeof o==="object"&&typeof o.filename==="string"&&typeof o.mimetype==="string"&&typeof o.data==="string"},y=(o)=>{if(!T(o))throw new Error("无效的文件 JSON 数据！");let{data:p,filename:W,mimetype:f}=o,g=atob(p),m=Uint8Array.from(g,(x)=>x.charCodeAt(0)),r=new Blob([m],{type:f}),b=URL.createObjectURL(r),v=Object.assign(document.createElement("a"),{href:b,download:W,style:"display: none"});document.body.appendChild(v),v.click(),setTimeout(()=>{document.body.removeChild(v),URL.revokeObjectURL(b)},0)};var i=(o,p)=>{switch(p.type){case 0:return{progress:p.progress??0,note:`Downloading... ${p.progress?.toFixed(2)}%`,enableButton:!1};case 1:return{progress:100,note:"Parsing...",enableButton:!1};case 2:return{progress:100,note:"Completed!",enableButton:!0};case 3:return{progress:0,note:p.note??"error!",enableButton:!0};default:return o}},k={progress:0,note:"",enableButton:!0},l=L(({src:o,_key:p,filename:W})=>{let[f,g]=F(i,k);q(()=>{return document.body.className=Q,()=>{document.body.className=""}},[]);let m=I((b)=>{g({type:0,progress:b})},[]),r=I(async()=>{if(!o)throw new Error("unknown target file");g({type:0,progress:0}),A(o,m).then((b)=>{return g({type:1}),b}).then(async(b)=>{let v=new Blob([b]),x=URL.createObjectURL(v),H=await z(x);URL.revokeObjectURL(x);let M=await h(H,p),N=JSON.parse(M);y(N)}).then(()=>{g({type:2})}).catch((b)=>{console.error(b),alert(b);let v=b.message==="The operation failed for an operation-specific reason"?"invalid key!":"failed to download!";g({type:3,note:v})})},[]);return K(C,{children:[d("title",{children:"File Download"}),d("style",{children:V}),K("div",{className:R,children:[d("div",{className:U,children:"Download File"}),d("div",{className:Y,children:W||"unknown file"}),d("button",{className:X,onClick:r,disabled:!f.enableButton,children:"Download"}),d("div",{className:$,children:d("div",{className:E,style:{width:`${f.progress}%`}})}),d("div",{className:Z,children:f.note})]})]})}),c=l;export{c as default};
