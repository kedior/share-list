import{e as q,g as W,h as u,j as z,m as R,n as G,p as H,t as I,u as d,v as Y}from"./chunk-6qcj2fhe.js";import"./chunk-tvcwmejv.js";R();var C="YMw3CW-body",m="YMw3CW-container",i="YMw3CW-download-button",t="YMw3CW-filename",h="YMw3CW-note",v="YMw3CW-progress-bar",_="YMw3CW-progress-bar-inner",k="YMw3CW-title";var B=".YMw3CW-body{color:#333;background-color:#f5f5f7;background-position:50%;background-repeat:no-repeat;background-size:cover;background-attachment:fixed;justify-content:center;align-items:center;height:100vh;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;display:flex}.YMw3CW-container{text-align:center;background:#fff;border-radius:12px;max-width:600px;padding:20px;box-shadow:0 4px 10px #0000001a}.YMw3CW-title{margin-bottom:20px;font-size:1.5rem}.YMw3CW-filename{color:#555;word-wrap:break-word;margin-bottom:10px;font-size:1.2rem}.YMw3CW-progress-bar{background:#e5e5e7;border-radius:5px;width:100%;height:10px;margin-top:20px;margin-bottom:20px;overflow:hidden}.YMw3CW-progress-bar-inner{background:#007aff;width:0%;height:100%;transition:width .2s}.YMw3CW-download-button{color:#fff;cursor:pointer;background:#007aff;border:none;border-radius:8px;padding:12px 24px;font-size:1rem;transition:background-color .3s}.YMw3CW-download-button:disabled{cursor:not-allowed;background:#8e8e93}.YMw3CW-download-button:hover:not(:disabled){background:#005bb5}.YMw3CW-note{color:#666;min-height:20px;margin-top:10px;font-size:.85rem}";var N=131072,X=async(r,w)=>{let f=(await fetch(r,{method:"HEAD"})).headers.get("Content-Length");if(!f)throw new Error("Failed to fetch file size.");let b=parseInt(f,10),p=0,e=[];for(let o=0;o<b;o+=N){let g=Math.min(o+N-1,b-1),M=await(await fetch(r,{headers:{Range:`bytes=${o}-${g}`}})).arrayBuffer();e.push(M),p+=M.byteLength,w(p/b*100)}return new Blob(e).arrayBuffer()},Z=(r)=>{return typeof r==="object"&&typeof r.filename==="string"&&typeof r.mimetype==="string"&&typeof r.data==="string"},$=(r)=>{if(!Z(r))throw new Error("无效的文件 JSON 数据！");let{data:w,filename:x,mimetype:f}=r,b=atob(w),p=Uint8Array.from(b,(n)=>n.charCodeAt(0)),e=new Blob([p],{type:f}),o=URL.createObjectURL(e),g=Object.assign(document.createElement("a"),{href:o,download:x,style:"display: none"});document.body.appendChild(g),g.click(),setTimeout(()=>{document.body.removeChild(g),URL.revokeObjectURL(o)},0)};var E=(r,w)=>{switch(w.type){case 0:return{progress:w.progress??0,note:`Downloading... ${w.progress?.toFixed(2)}%`,enableButton:!1};case 1:return{progress:100,note:"Parsing...",enableButton:!1};case 2:return{progress:100,note:"Completed!",enableButton:!0};case 3:return{progress:0,note:w.note??"error!",enableButton:!0};default:return r}},J={progress:0,note:"",enableButton:!0},U=q(({src:r,_key:w,filename:x})=>{let[f,b]=z(E,J);u(()=>{return document.body.className=C,()=>{document.body.className=""}},[]);let p=W((o)=>{b({type:0,progress:o})},[]),e=W(async()=>{if(!r)throw new Error("unknown target file");b({type:0,progress:0}),X(r,p).then((o)=>{return b({type:1}),o}).then(async(o)=>{let g=new Blob([o]),n=URL.createObjectURL(g),M=await H(n);URL.revokeObjectURL(n);let K=await G(M,w),O=JSON.parse(K);$(O)}).then(()=>{b({type:2})}).catch((o)=>{console.error(o);let g=o.message==="The operation failed for an operation-specific reason"?"invalid key!":"failed to download!";b({type:3,note:g})})},[]);return Y(I,{children:[d("title",{children:"File Download"}),d("style",{children:B}),Y("div",{className:m,children:[d("div",{className:k,children:"Download File"}),d("div",{className:t,children:x||"unknown file"}),d("button",{className:i,onClick:e,disabled:!f.enableButton,children:"Download"}),d("div",{className:v,children:d("div",{className:_,style:{width:`${f.progress}%`}})}),d("div",{className:h,children:f.note})]})]})}),c=U;export{c as default};
