import{a as v}from"./chunk-btzy81gc.js";import{i as y,o as f,q as h,r as t}from"./chunk-shjdzr2s.js";import{s as k}from"./chunk-672wjejd.js";var g=k(v(),1);var m=131072;async function N(e,r){let s=(await fetch(e,{method:"HEAD"})).headers.get("Content-Length");if(!s)throw new Error("Failed to fetch file size.");let n=parseInt(s,10),o=0,a=[];for(let l=0;l<n;l+=m){let c=Math.min(l+m-1,n-1),i=await(await fetch(e,{headers:{Range:`bytes=${l}-${c}`}})).arrayBuffer();a.push(i),o+=i.byteLength,r(o/n*100)}return new Blob(a).arrayBuffer()}function F(e){return typeof e==="object"&&typeof e.filename==="string"&&typeof e.mimetype==="string"&&typeof e.data==="string"}async function A(e){if(!F(e))throw new Error("JSON 数据缺少必要的字段！");let r=atob(e.data),d=new Uint8Array(r.length);for(let o=0;o<r.length;o++)d[o]=r.charCodeAt(o);let s=new Blob([d],{type:e.mimetype}),n=document.createElement("a");n.href=URL.createObjectURL(s),n.download=e.filename,document.body.appendChild(n),n.click(),document.body.removeChild(n)}function B({src:e,_key:r,filename:d}){let[s,n]=f(0),[o,a]=f(""),[l,c]=f(!1);return t(y,{children:[t(g.default,{title:"File Download",link:[{rel:"stylesheet",type:"text/css",href:"./dist/download.css"}]},void 0,!1,void 0,this),t("div",{className:"container",children:[t("div",{className:"title",children:"Download File"},void 0,!1,void 0,this),t("div",{className:"filename",children:d||"unknown file"},void 0,!1,void 0,this),t("button",{className:"download-button",onClick:async()=>{c(!0),a("Downloading..."),n(0);try{if(!e)throw new Error("unknown target file");let i=await N(e,(w)=>{n(w),a(`Downloading... ${w.toFixed(2)}%`)});a("Parsing...");let u=await h(new Uint8Array(i),r),b=JSON.parse(u);await A(b),a("Completed!")}catch(i){if(console.error(i),n(0),i.message==="Malformed UTF-8 data")a("invalid key!");else a("failed to download!")}finally{c(!1)}},disabled:l,children:"Download"},void 0,!1,void 0,this),t("div",{className:"progress-bar",children:t("div",{className:"progress-bar-inner",style:{width:`${s}%`}},void 0,!1,void 0,this)},void 0,!1,void 0,this),t("div",{className:"note",children:o},void 0,!1,void 0,this)]},void 0,!0,void 0,this)]},void 0,!0,void 0,this)}export{B as default};
