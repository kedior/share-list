import{h as _,k,m as B,p as U,q as H,r as I,s as d,t as C}from"./chunk-c4j4bbj4.js";import"./chunk-8w9z3qeb.js";U();var Y="YMw3CW-body",n="YMw3CW-container",m="YMw3CW-download-button",t="YMw3CW-filename",i="YMw3CW-note",h="YMw3CW-progress-bar",u="YMw3CW-progress-bar-inner",v="YMw3CW-title";var c=".YMw3CW-body{color:#333;background-color:#f5f5f7;background-position:50%;background-repeat:no-repeat;background-size:cover;background-attachment:fixed;justify-content:center;align-items:center;height:100vh;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;display:flex}.YMw3CW-container{text-align:center;background:#fff;border-radius:12px;max-width:600px;padding:20px;box-shadow:0 4px 10px #0000001a}.YMw3CW-title{margin-bottom:20px;font-size:1.5rem}.YMw3CW-filename{color:#555;word-wrap:break-word;margin-bottom:10px;font-size:1.2rem}.YMw3CW-progress-bar{background:#e5e5e7;border-radius:5px;width:100%;height:10px;margin-top:20px;margin-bottom:20px;overflow:hidden}.YMw3CW-progress-bar-inner{background:#007aff;width:0%;height:100%;transition:width .2s}.YMw3CW-download-button{color:#fff;cursor:pointer;background:#007aff;border:none;border-radius:8px;padding:12px 24px;font-size:1rem;transition:background-color .3s}.YMw3CW-download-button:disabled{cursor:not-allowed;background:#8e8e93}.YMw3CW-download-button:hover:not(:disabled){background:#005bb5}.YMw3CW-note{color:#666;min-height:20px;margin-top:10px;font-size:.85rem}";var l=131072;async function q(o,e){let g=(await fetch(o,{method:"HEAD"})).headers.get("Content-Length");if(!g)throw new Error("Failed to fetch file size.");let r=parseInt(g,10),b=0,f=[];for(let w=0;w<r;w+=l){let x=Math.min(w+l-1,r-1),W=await(await fetch(o,{headers:{Range:`bytes=${w}-${x}`}})).arrayBuffer();f.push(W),b+=W.byteLength,e(b/r*100)}return new Blob(f).arrayBuffer()}function z(o){return typeof o==="object"&&typeof o.filename==="string"&&typeof o.mimetype==="string"&&typeof o.data==="string"}async function G(o){if(!z(o))throw new Error("JSON 数据缺少必要的字段！");let e=atob(o.data),p=new Uint8Array(e.length);for(let b=0;b<e.length;b++)p[b]=e.charCodeAt(b);let g=new Blob([p],{type:o.mimetype}),r=document.createElement("a");r.href=URL.createObjectURL(g),r.download=o.filename,document.body.appendChild(r),r.click(),document.body.removeChild(r)}var K=(o,e)=>{switch(e.type){case 0:return{progress:e.progress??0,note:`Downloading... ${e.progress?.toFixed(2)}%`,enableButton:!1};case 1:return{progress:100,note:"Parsing...",enableButton:!1};case 2:return{progress:100,note:"Completed!",enableButton:!0};case 3:return{progress:0,note:e.note??"error!",enableButton:!0};default:return o}},O={progress:0,note:"",enableButton:!0},Q=_(({src:o,_key:e,filename:p})=>{let[g,r]=B(K,O),b=async()=>{if(!o)throw new Error("unknown target file");r({type:0,progress:0});try{let f=await q(o,(M)=>{r({type:0,progress:M})});r({type:1});let w=await H(new Uint8Array(f),e),x=JSON.parse(w);await G(x),r({type:2})}catch(f){console.error(f);let w=f.message==="The operation failed for an operation-specific reason"?"invalid key!":"failed to download!";r({type:3,note:w})}};return k(()=>{return document.body.className=Y,()=>{document.body.className=""}},[]),C(I,{children:[d("title",{children:"File Download"}),d("style",{children:c}),C("div",{className:n,children:[d("div",{className:v,children:"Download File"}),d("div",{className:t,children:p||"unknown file"}),d("button",{className:m,onClick:b,disabled:!g.enableButton,children:"Download"}),d("div",{className:h,children:d("div",{className:u,style:{width:`${g.progress}%`}})}),d("div",{className:i,children:g.note})]})]})}),$=Q;export{$ as default};
