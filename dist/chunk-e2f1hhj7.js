import{f as H,h as m,i as I,k as K,o as X,p as L,q as x,r as w,s as M,u as O}from"./chunk-ypwewzwb.js";import"./chunk-573s6t0s.js";X();var z="PJv57W-body",h="PJv57W-container",_="PJv57W-download-button",k="PJv57W-filename",B="PJv57W-note",N="PJv57W-progress-bar",q="PJv57W-progress-bar-inner",u="PJv57W-title";var G=".PJv57W-body{color:#333;background-color:#f5f5f7;background-position:50%;background-repeat:no-repeat;background-size:cover;background-attachment:fixed;justify-content:center;align-items:center;height:100vh;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;display:flex}.PJv57W-container{text-align:center;background:#fff;border-radius:12px;max-width:600px;padding:20px;box-shadow:0 4px 10px #0000001a}.PJv57W-title{margin-bottom:20px;font-size:1.5rem}.PJv57W-filename{color:#555;word-wrap:break-word;margin-bottom:10px;font-size:1.2rem}.PJv57W-progress-bar{background:#e5e5e7;border-radius:5px;width:100%;height:10px;margin-top:20px;margin-bottom:20px;overflow:hidden}.PJv57W-progress-bar-inner{background:#007aff;width:0%;height:100%;transition:width .2s}.PJv57W-download-button{color:#fff;cursor:pointer;background:#007aff;border:none;border-radius:8px;padding:12px 24px;font-size:1rem;transition:background-color .3s}.PJv57W-download-button:disabled{cursor:not-allowed;background:#8e8e93}.PJv57W-download-button:hover:not(:disabled){background:#005bb5}.PJv57W-note{color:#666;min-height:20px;margin-top:10px;font-size:.85rem}";async function Y(b,f){let p=await fetch(b);if(!p.ok)throw new Error(`HTTP error! status: ${p.status}`);let r=p.headers.get("Content-Length");if(!r)throw new Error("unable to get file size");let v=parseInt(r,10),P=p.body.getReader(),W=[],o=0;while(!0){let{done:J,value:n}=await P.read();if(J)break;W.push(n),o+=n.length;let i=o/v*100;f(i)}let g=new Uint8Array(o),d=0;for(let J of W)g.set(J,d),d+=J.length;return g.buffer}var Z=(b)=>{return typeof b==="object"&&typeof b.filename==="string"&&typeof b.mimetype==="string"&&typeof b.data==="string"},$=(b)=>{if(!Z(b))throw new Error("无效的文件 JSON 数据！");let{data:f,filename:p,mimetype:r}=b,v=atob(f),P=Uint8Array.from(v,(d)=>d.charCodeAt(0)),W=new Blob([P],{type:r}),o=URL.createObjectURL(W),g=Object.assign(document.createElement("a"),{href:o,download:p,style:"display: none"});document.body.appendChild(g),g.click(),setTimeout(()=>{document.body.removeChild(g),URL.revokeObjectURL(o)},0)};var E=(b,f)=>{switch(f.type){case 0:return{progress:f.progress??0,note:`Downloading... ${f.progress?.toFixed(2)}%`,enableButton:!1};case 1:return{progress:100,note:"Parsing...",enableButton:!1};case 2:return{progress:100,note:"Completed!",enableButton:!0};case 3:return{progress:0,note:f.note??"error!",enableButton:!0};default:return b}},V={progress:0,note:"",enableButton:!0},e=H(({src:b,_key:f,filename:p})=>{let[r,v]=K(E,V);I(()=>{return document.body.className=z,()=>{document.body.className=""}},[]);let P=m((o)=>{v({type:0,progress:o})},[]),W=m(async()=>{if(!b)throw new Error("unknown target file");v({type:0,progress:0}),Y(b,P).then((o)=>{return v({type:1}),o}).then(async(o)=>{let g=new Blob([o]),d=await new Promise((Q,R)=>{let t=new FileReader;t.onload=()=>Q(t.result),t.onerror=R,t.readAsDataURL(g)}),J=await O(d),n=await M(J,f);alert(n);let i=JSON.parse(n);$(i)}).then(()=>{v({type:2})}).catch((o)=>{console.error(o),alert(o);let g=o.message==="The operation failed for an operation-specific reason"?"invalid key!":"failed to download!";v({type:3,note:g})})},[]);return w(L,{children:[x("title",{children:"File Download"}),x("style",{children:G}),w("div",{className:h,children:[x("div",{className:u,children:"Download File"}),x("div",{className:k,children:p||"unknown file"}),x("button",{className:_,onClick:W,disabled:!r.enableButton,children:"Download"}),x("div",{className:N,children:x("div",{className:q,style:{width:`${r.progress}%`}})}),x("div",{className:B,children:r.note})]})]})}),y=e;export{y as default};
