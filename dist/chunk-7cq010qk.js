import{h as _,m as g,o as z,p as k,q as B,r as b,s as x}from"./chunk-qe4g50fx.js";import"./chunk-qtapzvrz.js";z();var m="YMw3CW-container",C="YMw3CW-download-button",M="YMw3CW-filename",W="YMw3CW-note",Y="YMw3CW-progress-bar",h="YMw3CW-progress-bar-inner",u="YMw3CW-title";var v="body{color:#333;background-color:#f5f5f7;background-position:50%;background-repeat:no-repeat;background-size:cover;background-attachment:fixed;justify-content:center;align-items:center;height:100vh;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;display:flex}.YMw3CW-container{text-align:center;background:#fff;border-radius:12px;max-width:600px;padding:20px;box-shadow:0 4px 10px #0000001a}.YMw3CW-title{margin-bottom:20px;font-size:1.5rem}.YMw3CW-filename{color:#555;word-wrap:break-word;margin-bottom:10px;font-size:1.2rem}.YMw3CW-progress-bar{background:#e5e5e7;border-radius:5px;width:100%;height:10px;margin-top:20px;margin-bottom:20px;overflow:hidden}.YMw3CW-progress-bar-inner{background:#007aff;width:0%;height:100%;transition:width .2s}.YMw3CW-download-button{color:#fff;cursor:pointer;background:#007aff;border:none;border-radius:8px;padding:12px 24px;font-size:1rem;transition:background-color .3s}.YMw3CW-download-button:disabled{cursor:not-allowed;background:#8e8e93}.YMw3CW-download-button:hover:not(:disabled){background:#005bb5}.YMw3CW-note{color:#666;min-height:20px;margin-top:10px;font-size:.85rem}";var l=131072;async function E(o,n){let i=(await fetch(o,{method:"HEAD"})).headers.get("Content-Length");if(!i)throw new Error("Failed to fetch file size.");let r=parseInt(i,10),p=0,d=[];for(let c=0;c<r;c+=l){let w=Math.min(c+l-1,r-1),e=await(await fetch(o,{headers:{Range:`bytes=${c}-${w}`}})).arrayBuffer();d.push(e),p+=e.byteLength,n(p/r*100)}return new Blob(d).arrayBuffer()}function G(o){return typeof o==="object"&&typeof o.filename==="string"&&typeof o.mimetype==="string"&&typeof o.data==="string"}async function K(o){if(!G(o))throw new Error("JSON 数据缺少必要的字段！");let n=atob(o.data),f=new Uint8Array(n.length);for(let p=0;p<n.length;p++)f[p]=n.charCodeAt(p);let i=new Blob([f],{type:o.mimetype}),r=document.createElement("a");r.href=URL.createObjectURL(i),r.download=o.filename,document.body.appendChild(r),r.click(),document.body.removeChild(r)}var O=_(({src:o,_key:n,filename:f})=>{let[i,r]=g(0),[p,d]=g(""),[c,w]=g(!1);return x(B,{children:[b("title",{children:"File Download"}),b("style",{children:v}),x("div",{className:m,children:[b("div",{className:u,children:"Download File"}),b("div",{className:M,children:f||"unknown file"}),b("button",{className:C,onClick:async()=>{w(!0),d("Downloading..."),r(0);try{if(!o)throw new Error("unknown target file");let e=await E(o,(t)=>{r(t),d(`Downloading... ${t.toFixed(2)}%`)});d("Parsing...");let R=await k(new Uint8Array(e),n),U=JSON.parse(R);await K(U),d("Completed!"),r(100)}catch(e){if(console.error(e),r(0),e.message==="The operation failed for an operation-specific reason")d("invalid key!");else d("failed to download!")}finally{w(!1)}},disabled:c,children:"Download"}),b("div",{className:Y,children:b("div",{className:h,style:{width:`${i}%`}})}),b("div",{className:W,children:p})]})]})}),Z=O;export{Z as default};
