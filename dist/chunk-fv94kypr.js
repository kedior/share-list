import{f as h,h as B,i as E,k as U,o as z,p as V,q as v,r as N,s as L,u as t}from"./chunk-ypwewzwb.js";import"./chunk-573s6t0s.js";z();var K="PJv57W-body",M="PJv57W-container",O="PJv57W-download-button",Q="PJv57W-filename",R="PJv57W-note",X="PJv57W-progress-bar",Y="PJv57W-progress-bar-inner",Z="PJv57W-title";var $=".PJv57W-body{color:#333;background-color:#f5f5f7;background-position:50%;background-repeat:no-repeat;background-size:cover;background-attachment:fixed;justify-content:center;align-items:center;height:100vh;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;display:flex}.PJv57W-container{text-align:center;background:#fff;border-radius:12px;max-width:600px;padding:20px;box-shadow:0 4px 10px #0000001a}.PJv57W-title{margin-bottom:20px;font-size:1.5rem}.PJv57W-filename{color:#555;word-wrap:break-word;margin-bottom:10px;font-size:1.2rem}.PJv57W-progress-bar{background:#e5e5e7;border-radius:5px;width:100%;height:10px;margin-top:20px;margin-bottom:20px;overflow:hidden}.PJv57W-progress-bar-inner{background:#007aff;width:0%;height:100%;transition:width .2s}.PJv57W-download-button{color:#fff;cursor:pointer;background:#007aff;border:none;border-radius:8px;padding:12px 24px;font-size:1rem;transition:background-color .3s}.PJv57W-download-button:disabled{cursor:not-allowed;background:#8e8e93}.PJv57W-download-button:hover:not(:disabled){background:#005bb5}.PJv57W-note{color:#666;min-height:20px;margin-top:10px;font-size:.85rem}";var C=async(o,d,x=131072,W=6)=>{let P=(await fetch(o,{method:"HEAD"})).headers.get("Content-Length");if(!P)throw new Error("无法获取文件大小");let g=parseInt(P,10),b=Math.ceil(g/x),p=new Array(b),J=0,m=Array.from({length:b},(H,e)=>async()=>{let r=e*x,w=Math.min(r+x-1,g-1),I=await(await fetch(o,{headers:{Range:`bytes=${r}-${w}`}})).arrayBuffer();p[e]=I,J+=I.byteLength,d(J/g*100)});return await(async(H,e)=>{let r=[];for(let w of H){let _=w().then(()=>{r.splice(r.indexOf(_),1)});if(r.push(_),r.length>=e)await Promise.race(r)}await Promise.all(r)})(m,W),new Blob(p).arrayBuffer()},k=(o)=>{return typeof o==="object"&&typeof o.filename==="string"&&typeof o.mimetype==="string"&&typeof o.data==="string"},i=(o)=>{if(!k(o))throw new Error("无效的文件 JSON 数据！");let{data:d,filename:x,mimetype:W}=o,f=atob(d),P=Uint8Array.from(f,(J)=>J.charCodeAt(0)),g=new Blob([P],{type:W}),b=URL.createObjectURL(g),p=Object.assign(document.createElement("a"),{href:b,download:x,style:"display: none"});document.body.appendChild(p),p.click(),setTimeout(()=>{document.body.removeChild(p),URL.revokeObjectURL(b)},0)};var A=(o,d)=>{switch(d.type){case 0:return{progress:d.progress??0,note:`Downloading... ${d.progress?.toFixed(2)}%`,enableButton:!1};case 1:return{progress:100,note:"Parsing...",enableButton:!1};case 2:return{progress:100,note:"Completed!",enableButton:!0};case 3:return{progress:0,note:d.note??"error!",enableButton:!0};default:return o}},T={progress:0,note:"",enableButton:!0},l=h(({src:o,_key:d,filename:x})=>{let[W,f]=U(A,T);E(()=>{return document.body.className=K,()=>{document.body.className=""}},[]);let P=B((b)=>{f({type:0,progress:b})},[]),g=B(async()=>{if(!o)throw new Error("unknown target file");f({type:0,progress:0}),C(o,P).then((b)=>{return f({type:1}),b}).then(async(b)=>{let p=new Blob([b]),J=URL.createObjectURL(p),m=await t(J);URL.revokeObjectURL(J);let q=await L(m,d),G=JSON.parse(q);i(G)}).then(()=>{f({type:2})}).catch((b)=>{console.error(b),alert(b);let p=b.message==="The operation failed for an operation-specific reason"?"invalid key!":"failed to download!";f({type:3,note:p})})},[]);return N(V,{children:[v("title",{children:"File Download"}),v("style",{children:$}),N("div",{className:M,children:[v("div",{className:Z,children:"Download File"}),v("div",{className:Q,children:x||"unknown file"}),v("button",{className:O,onClick:g,disabled:!W.enableButton,children:"Download"}),v("div",{className:X,children:v("div",{className:Y,style:{width:`${W.progress}%`}})}),v("div",{className:R,children:W.note})]})]})}),c=l;export{c as default};
