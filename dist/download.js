import{d,g as h}from"./chunk-9k4tmcwk.js";var g=document.getElementById("progressBar"),n=document.getElementById("note"),f=document.getElementById("filename"),b=131072,w=document.getElementById("download");async function x(e){let o=(await fetch(e,{method:"HEAD"})).headers.get("Content-Length");if(!o)throw new Error("Failed to fetch file size.");let l=parseInt(o,10),r=0,v=[];for(let t=0;t<l;t+=b){let i=Math.min(t+b-1,l-1),c=await(await fetch(e,{headers:{Range:`bytes=${t}-${i}`}})).arrayBuffer();v.push(c),r+=c.byteLength;let s=r/l*100;g.style.width=`${s.toFixed(2)}%`,n.textContent=`Downloading... ${s.toFixed(2)}%`}return await new Blob(v).arrayBuffer()}function u(e){return typeof e==="object"&&typeof e.filename==="string"&&typeof e.mimetype==="string"&&typeof e.data==="string"}async function m(e){if(!u(e))throw new Error("JSON 数据缺少必要的字段！");let{filename:a,mimetype:o,data:l}=e,r=atob(l),v=new Uint8Array(r.length);for(let p=0;p<r.length;p++)v[p]=r.charCodeAt(p);let t=new Blob([v],{type:o}),i=document.createElement("a");return i.href=URL.createObjectURL(t),i.download=a,document.body.appendChild(i),i.click(),document.body.removeChild(i),!0}var z=h("src"),k=h("key"),y=h("filename");f.innerText=y;w.addEventListener("click",async()=>{w.disabled=!0;try{n.textContent="Downloading...";let e=await x(z);n.textContent="Parsing...";let a=d(e,k),o=JSON.parse(a);await m(o),n.innerText="Completed!"}catch(e){if(e instanceof Error&&e.message==="Malformed UTF-8 data")n.textContent="invalid key!";else n.textContent="failed to download!";console.log(e),g.style.width="0%"}finally{w.disabled=!1}});
