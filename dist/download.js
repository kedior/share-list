import{b as m,d as u}from"./chunk-xtnz9r88.js";import"./chunk-y89ztfqf.js";var w=document.getElementById("progressBar"),i=document.getElementById("note"),v=document.getElementById("filename"),n=131072,f=document.getElementById("downloadButton");async function k(o){let d=(await fetch(o,{method:"HEAD"})).headers.get("Content-Length");if(!d)throw new Error("Failed to fetch file size.");let e=parseInt(d,10),b=0,x=[];for(let p=0;p<e;p+=n){let g=Math.min(p+n-1,e-1),h=await(await fetch(o,{headers:{Range:`bytes=${p}-${g}`}})).arrayBuffer();x.push(h),b+=h.byteLength;let t=b/e*100;w.style.width=`${t.toFixed(2)}%`,i.textContent=`Downloading... ${t.toFixed(2)}%`}return await new Blob(x).arrayBuffer()}function H(o){return typeof o==="object"&&typeof o.filename==="string"&&typeof o.mimetype==="string"&&typeof o.data==="string"}async function I(o){if(!H(o))throw new Error("JSON 数据缺少必要的字段！");let{filename:c,mimetype:d,data:e}=o,b=atob(e),x=new Uint8Array(b.length);for(let r=0;r<b.length;r++)x[r]=b.charCodeAt(r);let p=new Blob([x],{type:d}),g=document.createElement("a");return g.href=URL.createObjectURL(p),g.download=c,document.body.appendChild(g),g.click(),document.body.removeChild(g),!0}var M=m("src"),N=m("key"),R=m("filename");v.innerText=R;f.addEventListener("click",async()=>{f.disabled=!0;try{i.textContent="Downloading...";let o=await k(M);i.textContent="Parsing...";let c=u(o,N),d=JSON.parse(c);await I(d),i.innerText="Completed!"}catch(o){if(o instanceof Error&&o.message==="Malformed UTF-8 data")i.textContent="invalid key!";else i.textContent="failed to download!";console.log(o),w.style.width="0%"}finally{f.disabled=!1}});
