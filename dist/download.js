import{d as s,g as h}from"./chunk-9k4tmcwk.js";var g=document.getElementById("progressBar"),n=document.getElementById("note"),f=document.getElementById("filename"),b=131072,c=document.getElementById("downloadButton");async function x(e){let i=(await fetch(e,{method:"HEAD"})).headers.get("Content-Length");if(!i)throw new Error("Failed to fetch file size.");let a=parseInt(i,10),r=0,l=[];for(let t=0;t<a;t+=b){let o=Math.min(t+b-1,a-1),d=await(await fetch(e,{headers:{Range:`bytes=${t}-${o}`}})).arrayBuffer();l.push(d),r+=d.byteLength;let w=r/a*100;g.style.width=`${w.toFixed(2)}%`,n.textContent=`Downloading... ${w.toFixed(2)}%`}return await new Blob(l).arrayBuffer()}function u(e){return typeof e==="object"&&typeof e.filename==="string"&&typeof e.mimetype==="string"&&typeof e.data==="string"}async function m(e){if(!u(e))throw new Error("JSON 数据缺少必要的字段！");let{filename:v,mimetype:i,data:a}=e,r=atob(a),l=new Uint8Array(r.length);for(let p=0;p<r.length;p++)l[p]=r.charCodeAt(p);let t=new Blob([l],{type:i}),o=document.createElement("a");return o.href=URL.createObjectURL(t),o.download=v,document.body.appendChild(o),o.click(),document.body.removeChild(o),!0}var k=h("src"),z=h("key"),y=h("filename");f.innerText=y;c.addEventListener("click",async()=>{c.disabled=!0;try{n.textContent="Downloading...";let e=await x(k);n.textContent="Parsing...";let v=s(e,z),i=JSON.parse(v);await m(i),n.innerText="Completed!"}catch(e){if(e instanceof Error&&e.message==="Malformed UTF-8 data")n.textContent="invalid key!";else n.textContent="failed to download!";console.log(e),g.style.width="0%"}finally{c.disabled=!1}});
