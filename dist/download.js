import{a as h,b as c,c as w,f as m,h as y,i as a}from"./chunk-bg7vxzpd.js";import"./chunk-k8m6vq7p.js";var u=131072;async function F(e,r){let o=(await fetch(e,{method:"HEAD"})).headers.get("Content-Length");if(!o)throw new Error("Failed to fetch file size.");let n=parseInt(o,10),t=0,l=[];for(let i=0;i<n;i+=u){let p=Math.min(i+u-1,n-1),d=await(await fetch(e,{headers:{Range:`bytes=${i}-${p}`}})).arrayBuffer();l.push(d),t+=d.byteLength,r(t/n*100)}return new Blob(l).arrayBuffer()}function N(e){return typeof e==="object"&&typeof e.filename==="string"&&typeof e.mimetype==="string"&&typeof e.data==="string"}async function S(e){if(!N(e))throw new Error("JSON 数据缺少必要的字段！");let r=atob(e.data),s=new Uint8Array(r.length);for(let t=0;t<r.length;t++)s[t]=r.charCodeAt(t);let o=new Blob([s],{type:e.mimetype}),n=document.createElement("a");n.href=URL.createObjectURL(o),n.download=e.filename,document.body.appendChild(n),n.click(),document.body.removeChild(n)}function k(){let[e,r]=c(0),[s,o]=c(""),[n,t]=c(!1),[l,i]=c(""),p=m("src"),g=m("key"),d=m("filename");return w(()=>{i(d||"unknown file")},[d]),a("div",{className:"container",children:[a("div",{className:"title",children:"Download File"},void 0,!1,void 0,this),a("div",{className:"filename",children:l},void 0,!1,void 0,this),a("button",{className:"download-button",onClick:async()=>{t(!0),o("Downloading..."),r(0);try{let f=await F(p,(b)=>{r(b),o(`Downloading... ${b.toFixed(2)}%`)});o("Parsing...");let v=y(f,g),x=JSON.parse(v);await S(x),o("Completed!")}catch(f){if(console.error(f),r(0),f.message==="Malformed UTF-8 data")o("invalid key!");else o("failed to download!")}finally{t(!1)}},disabled:n,children:"Download"},void 0,!1,void 0,this),a("div",{className:"progress-bar",children:a("div",{className:"progress-bar-inner",style:{width:`${e}%`}},void 0,!1,void 0,this)},void 0,!1,void 0,this),a("div",{className:"note",children:s},void 0,!1,void 0,this)]},void 0,!0,void 0,this)}h(a(k,{},void 0,!1,void 0,this),document.body);export{k as default};
