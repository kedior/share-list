import{f as u,h as e,i as G,k as H,o as O,p as I,q as g,r as i,s as K,u as L}from"./chunk-ypwewzwb.js";import"./chunk-573s6t0s.js";O();var m="PJv57W-body",w="PJv57W-container",z="PJv57W-download-button",h="PJv57W-filename",_="PJv57W-note",k="PJv57W-progress-bar",B="PJv57W-progress-bar-inner",N="PJv57W-title";var q=".PJv57W-body{color:#333;background-color:#f5f5f7;background-position:50%;background-repeat:no-repeat;background-size:cover;background-attachment:fixed;justify-content:center;align-items:center;height:100vh;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;display:flex}.PJv57W-container{text-align:center;background:#fff;border-radius:12px;max-width:600px;padding:20px;box-shadow:0 4px 10px #0000001a}.PJv57W-title{margin-bottom:20px;font-size:1.5rem}.PJv57W-filename{color:#555;word-wrap:break-word;margin-bottom:10px;font-size:1.2rem}.PJv57W-progress-bar{background:#e5e5e7;border-radius:5px;width:100%;height:10px;margin-top:20px;margin-bottom:20px;overflow:hidden}.PJv57W-progress-bar-inner{background:#007aff;width:0%;height:100%;transition:width .2s}.PJv57W-download-button{color:#fff;cursor:pointer;background:#007aff;border:none;border-radius:8px;padding:12px 24px;font-size:1rem;transition:background-color .3s}.PJv57W-download-button:disabled{cursor:not-allowed;background:#8e8e93}.PJv57W-download-button:hover:not(:disabled){background:#005bb5}.PJv57W-note{color:#666;min-height:20px;margin-top:10px;font-size:.85rem}";async function Q(r,b){let v=await fetch(r);if(!v.ok)throw new Error(`HTTP error! status: ${v.status}`);let x=v.headers.get("Content-Length");if(!x)throw new Error("unable to get file size");let d=parseInt(x,10),P=v.body.getReader(),W=[],o=0;while(!0){let{done:J,value:n}=await P.read();if(J)break;W.push(n),o+=n.length;let t=o/d*100;b(t)}let f=new Uint8Array(o),p=0;for(let J of W)f.set(J,p),p+=J.length;return f.buffer}var R=(r)=>{return typeof r==="object"&&typeof r.filename==="string"&&typeof r.mimetype==="string"&&typeof r.data==="string"},X=(r)=>{if(!R(r))throw new Error("无效的文件 JSON 数据！");let{data:b,filename:v,mimetype:x}=r,d=atob(b),P=Uint8Array.from(d,(p)=>p.charCodeAt(0)),W=new Blob([P],{type:x}),o=URL.createObjectURL(W),f=Object.assign(document.createElement("a"),{href:o,download:v,style:"display: none"});document.body.appendChild(f),f.click(),setTimeout(()=>{document.body.removeChild(f),URL.revokeObjectURL(o)},0)};var Y=(r,b)=>{switch(b.type){case 0:return{progress:b.progress??0,note:`Downloading... ${b.progress?.toFixed(2)}%`,enableButton:!1};case 1:return{progress:100,note:"Parsing...",enableButton:!1};case 2:return{progress:100,note:"Completed!",enableButton:!0};case 3:return{progress:0,note:b.note??"error!",enableButton:!0};default:return r}},Z={progress:0,note:"",enableButton:!0},$=u(({src:r,_key:b,filename:v})=>{let[x,d]=H(Y,Z);G(()=>{return document.body.className=m,()=>{document.body.className=""}},[]);let P=e((o)=>{d({type:0,progress:o})},[]),W=e(async()=>{if(!r)throw new Error("unknown target file");d({type:0,progress:0}),Q(r,P).then((o)=>{return d({type:1}),o}).then(async(o)=>{let f=new Blob([o]),p=URL.createObjectURL(f),J=await L(p);URL.revokeObjectURL(p);let n=await K(J,b);alert(n);let t=JSON.parse(n);X(t)}).then(()=>{d({type:2})}).catch((o)=>{console.error(o),alert(o);let f=o.message==="The operation failed for an operation-specific reason"?"invalid key!":"failed to download!";d({type:3,note:f})})},[]);return i(I,{children:[g("title",{children:"File Download"}),g("style",{children:q}),i("div",{className:w,children:[g("div",{className:N,children:"Download File"}),g("div",{className:h,children:v||"unknown file"}),g("button",{className:z,onClick:W,disabled:!x.enableButton,children:"Download"}),g("div",{className:k,children:g("div",{className:B,style:{width:`${x.progress}%`}})}),g("div",{className:_,children:x.note})]})]})}),c=$;export{c as default};
