import{e as x}from"./chunk-cy1vqp11.js";import{h as b,n as f,p as u,q as t}from"./chunk-w84etn2h.js";import{r as v}from"./chunk-vvqbsyc2.js";var w=v(x(),1);var g='body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;margin:0;padding:0;display:flex;align-items:center;justify-content:center;height:100vh;background-color:#f5f5f7;background-repeat:no-repeat;background-size:cover;background-position:center;background-attachment:fixed;color:#333}.container{text-align:center;max-width:600px;padding:20px;background:#fff;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,.1)}.title{font-size:1.5rem;margin-bottom:20px}.filename{font-size:1.2rem;color:#555;margin-bottom:10px;word-wrap:break-word}.progress-bar{width:100%;height:10px;background:#e5e5e7;border-radius:5px;overflow:hidden;margin-top:20px;margin-bottom:20px}.progress-bar-inner{height:100%;width:0%;background:#007aff;transition:width .2s}.download-button{padding:12px 24px;font-size:1rem;color:#fff;background:#007aff;border:0;border-radius:8px;cursor:pointer;transition:background-color .3s}.download-button:disabled{background:#8e8e93;cursor:not-allowed}.download-button:hover:not(:disabled){background:#005bb5}.note{font-size:.85rem;color:#666;margin-top:10px;min-height:20px}';var m=131072;async function N(e,a){let s=(await fetch(e,{method:"HEAD"})).headers.get("Content-Length");if(!s)throw new Error("Failed to fetch file size.");let o=parseInt(s,10),n=0,r=[];for(let d=0;d<o;d+=m){let c=Math.min(d+m-1,o-1),i=await(await fetch(e,{headers:{Range:`bytes=${d}-${c}`}})).arrayBuffer();r.push(i),n+=i.byteLength,a(n/o*100)}return new Blob(r).arrayBuffer()}function F(e){return typeof e==="object"&&typeof e.filename==="string"&&typeof e.mimetype==="string"&&typeof e.data==="string"}async function S(e){if(!F(e))throw new Error("JSON 数据缺少必要的字段！");let a=atob(e.data),l=new Uint8Array(a.length);for(let n=0;n<a.length;n++)l[n]=a.charCodeAt(n);let s=new Blob([l],{type:e.mimetype}),o=document.createElement("a");o.href=URL.createObjectURL(s),o.download=e.filename,document.body.appendChild(o),o.click(),document.body.removeChild(o)}function z({src:e,_key:a,filename:l}){let[s,o]=f(0),[n,r]=f(""),[d,c]=f(!1);return t(b,{children:[t(w.default,{title:"File Download",style:[{type:"text/css",cssText:g}]},void 0,!1,void 0,this),t("div",{className:"container",children:[t("div",{className:"title",children:"Download File"},void 0,!1,void 0,this),t("div",{className:"filename",children:l||"unknown file"},void 0,!1,void 0,this),t("button",{className:"download-button",onClick:async()=>{c(!0),r("Downloading..."),o(0);try{if(!e)throw new Error("unknown target file");let i=await N(e,(p)=>{o(p),r(`Downloading... ${p.toFixed(2)}%`)});r("Parsing...");let y=await u(new Uint8Array(i),a),k=JSON.parse(y);await S(k),r("Completed!")}catch(i){if(console.error(i),o(0),i.message==="Malformed UTF-8 data")r("invalid key!");else r("failed to download!")}finally{c(!1)}},disabled:d,children:"Download"},void 0,!1,void 0,this),t("div",{className:"progress-bar",children:t("div",{className:"progress-bar-inner",style:{width:`${s}%`}},void 0,!1,void 0,this)},void 0,!1,void 0,this),t("div",{className:"note",children:n},void 0,!1,void 0,this)]},void 0,!0,void 0,this)]},void 0,!0,void 0,this)}export{z as default};
