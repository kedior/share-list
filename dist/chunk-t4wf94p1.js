import{f as u,h as J,i as z,k as G,o as R,p as H,q as f,r as P,s as I,u as K}from"./chunk-kvhv483w.js";import"./chunk-573s6t0s.js";R();var m="PJv57W-body",i="PJv57W-container",w="PJv57W-download-button",t="PJv57W-filename",h="PJv57W-note",_="PJv57W-progress-bar",k="PJv57W-progress-bar-inner",B="PJv57W-title";var N=".PJv57W-body{color:#333;background-color:#f5f5f7;background-position:50%;background-repeat:no-repeat;background-size:cover;background-attachment:fixed;justify-content:center;align-items:center;height:100vh;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;display:flex}.PJv57W-container{text-align:center;background:#fff;border-radius:12px;max-width:600px;padding:20px;box-shadow:0 4px 10px #0000001a}.PJv57W-title{margin-bottom:20px;font-size:1.5rem}.PJv57W-filename{color:#555;word-wrap:break-word;margin-bottom:10px;font-size:1.2rem}.PJv57W-progress-bar{background:#e5e5e7;border-radius:5px;width:100%;height:10px;margin-top:20px;margin-bottom:20px;overflow:hidden}.PJv57W-progress-bar-inner{background:#007aff;width:0%;height:100%;transition:width .2s}.PJv57W-download-button{color:#fff;cursor:pointer;background:#007aff;border:none;border-radius:8px;padding:12px 24px;font-size:1rem;transition:background-color .3s}.PJv57W-download-button:disabled{cursor:not-allowed;background:#8e8e93}.PJv57W-download-button:hover:not(:disabled){background:#005bb5}.PJv57W-note{color:#666;min-height:20px;margin-top:10px;font-size:.85rem}";var q=131072,X=async(r,g)=>{let p=(await fetch(r,{method:"HEAD"})).headers.get("Content-Length");if(!p)throw new Error("Failed to fetch file size.");let b=parseInt(p,10),v=0,e=[];for(let o=0;o<b;o+=q){let d=Math.min(o+q-1,b-1),W=await(await fetch(r,{headers:{Range:`bytes=${o}-${d}`}})).arrayBuffer();e.push(W),v+=W.byteLength,g(v/b*100)}return new Blob(e).arrayBuffer()},Y=(r)=>{return typeof r==="object"&&typeof r.filename==="string"&&typeof r.mimetype==="string"&&typeof r.data==="string"},Z=(r)=>{if(!Y(r))throw new Error("无效的文件 JSON 数据！");let{data:g,filename:x,mimetype:p}=r,b=atob(g),v=Uint8Array.from(b,(n)=>n.charCodeAt(0)),e=new Blob([v],{type:p}),o=URL.createObjectURL(e),d=Object.assign(document.createElement("a"),{href:o,download:x,style:"display: none"});document.body.appendChild(d),d.click(),setTimeout(()=>{document.body.removeChild(d),URL.revokeObjectURL(o)},0)};var $=(r,g)=>{switch(g.type){case 0:return{progress:g.progress??0,note:`Downloading... ${g.progress?.toFixed(2)}%`,enableButton:!1};case 1:return{progress:100,note:"Parsing...",enableButton:!1};case 2:return{progress:100,note:"Completed!",enableButton:!0};case 3:return{progress:0,note:g.note??"error!",enableButton:!0};default:return r}},E={progress:0,note:"",enableButton:!0},U=u(({src:r,_key:g,filename:x})=>{let[p,b]=G($,E);z(()=>{return document.body.className=m,()=>{document.body.className=""}},[]);let v=J((o)=>{b({type:0,progress:o})},[]),e=J(async()=>{if(!r)throw new Error("unknown target file");b({type:0,progress:0}),X(r,v).then((o)=>{return b({type:1}),o}).then(async(o)=>{let d=new Blob([o]),n=URL.createObjectURL(d),W=await K(n);URL.revokeObjectURL(n);let M=await I(W,g),O=JSON.parse(M);Z(O)}).then(()=>{b({type:2})}).catch((o)=>{console.error(o);let d=o.message==="The operation failed for an operation-specific reason"?"invalid key!":"failed to download!";b({type:3,note:d})})},[]);return P(H,{children:[f("title",{children:"File Download"}),f("style",{children:N}),P("div",{className:i,children:[f("div",{className:B,children:"Download File"}),f("div",{className:t,children:x||"unknown file"}),f("button",{className:w,onClick:e,disabled:!p.enableButton,children:"Download"}),f("div",{className:_,children:f("div",{className:k,style:{width:`${p.progress}%`}})}),f("div",{className:h,children:p.note})]})]})}),c=U;export{c as default};
