import{h as H,k as R,m as g,o as K,p as U,q as l,r as d,s as x}from"./chunk-qe4g50fx.js";import"./chunk-qtapzvrz.js";K();var M="YMw3CW-body",W="YMw3CW-container",Y="YMw3CW-download-button",m="YMw3CW-filename",h="YMw3CW-note",u="YMw3CW-progress-bar",v="YMw3CW-progress-bar-inner",_="YMw3CW-title";var k=".YMw3CW-body{color:#333;background-color:#f5f5f7;background-position:50%;background-repeat:no-repeat;background-size:cover;background-attachment:fixed;justify-content:center;align-items:center;height:100vh;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;display:flex}.YMw3CW-container{text-align:center;background:#fff;border-radius:12px;max-width:600px;padding:20px;box-shadow:0 4px 10px #0000001a}.YMw3CW-title{margin-bottom:20px;font-size:1.5rem}.YMw3CW-filename{color:#555;word-wrap:break-word;margin-bottom:10px;font-size:1.2rem}.YMw3CW-progress-bar{background:#e5e5e7;border-radius:5px;width:100%;height:10px;margin-top:20px;margin-bottom:20px;overflow:hidden}.YMw3CW-progress-bar-inner{background:#007aff;width:0%;height:100%;transition:width .2s}.YMw3CW-download-button{color:#fff;cursor:pointer;background:#007aff;border:none;border-radius:8px;padding:12px 24px;font-size:1rem;transition:background-color .3s}.YMw3CW-download-button:disabled{cursor:not-allowed;background:#8e8e93}.YMw3CW-download-button:hover:not(:disabled){background:#005bb5}.YMw3CW-note{color:#666;min-height:20px;margin-top:10px;font-size:.85rem}";var B=131072;async function O(o,n){let c=(await fetch(o,{method:"HEAD"})).headers.get("Content-Length");if(!c)throw new Error("Failed to fetch file size.");let r=parseInt(c,10),p=0,b=[];for(let e=0;e<r;e+=B){let w=Math.min(e+B-1,r-1),i=await(await fetch(o,{headers:{Range:`bytes=${e}-${w}`}})).arrayBuffer();b.push(i),p+=i.byteLength,n(p/r*100)}return new Blob(b).arrayBuffer()}function Q(o){return typeof o==="object"&&typeof o.filename==="string"&&typeof o.mimetype==="string"&&typeof o.data==="string"}async function T(o){if(!Q(o))throw new Error("JSON 数据缺少必要的字段！");let n=atob(o.data),f=new Uint8Array(n.length);for(let p=0;p<n.length;p++)f[p]=n.charCodeAt(p);let c=new Blob([f],{type:o.mimetype}),r=document.createElement("a");r.href=URL.createObjectURL(c),r.download=o.filename,document.body.appendChild(r),r.click(),document.body.removeChild(r)}var X=H(({src:o,_key:n,filename:f})=>{let[c,r]=g(0),[p,b]=g(""),[e,w]=g(!1),t=async()=>{w(!0),b("Downloading..."),r(0);try{if(!o)throw new Error("unknown target file");let i=await O(o,(C)=>{r(C),b(`Downloading... ${C.toFixed(2)}%`)});b("Parsing...");let q=await U(new Uint8Array(i),n),z=JSON.parse(q);await T(z),b("Completed!"),r(100)}catch(i){if(console.error(i),r(0),i.message==="The operation failed for an operation-specific reason")b("invalid key!");else b("failed to download!")}finally{w(!1)}};return R(()=>{return document.body.className=M,()=>{document.body.className=""}},[]),x(l,{children:[d("title",{children:"File Download"}),d("style",{children:k}),x("div",{className:W,children:[d("div",{className:_,children:"Download File"}),d("div",{className:m,children:f||"unknown file"}),d("button",{className:Y,onClick:t,disabled:e,children:"Download"}),d("div",{className:u,children:d("div",{className:v,style:{width:`${c}%`}})}),d("div",{className:h,children:p})]})]})}),E=X;export{E as default};
