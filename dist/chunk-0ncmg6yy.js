import{k as I,m as P,n as N,p as c,s as L,t as q,u as f,v as n,x as u}from"./chunk-dh0jzzfb.js";L();var i="PJv57W-body",m="PJv57W-container",w="PJv57W-download-button",z="PJv57W-filename",_="PJv57W-note",h="PJv57W-progress-bar",k="PJv57W-progress-bar-inner",B="PJv57W-title";var H=".PJv57W-body{color:#333;background-color:#f5f5f7;background-position:50%;background-repeat:no-repeat;background-size:cover;background-attachment:fixed;justify-content:center;align-items:center;height:100vh;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;display:flex}.PJv57W-container{text-align:center;background:#fff;border-radius:12px;max-width:600px;padding:20px;box-shadow:0 4px 10px #0000001a}.PJv57W-title{margin-bottom:20px;font-size:1.5rem}.PJv57W-filename{color:#555;word-wrap:break-word;margin-bottom:10px;font-size:1.2rem}.PJv57W-progress-bar{background:#e5e5e7;border-radius:5px;width:100%;height:10px;margin-top:20px;margin-bottom:20px;overflow:hidden}.PJv57W-progress-bar-inner{background:#007aff;width:0%;height:100%;transition:width .2s}.PJv57W-download-button{color:#fff;cursor:pointer;background:#007aff;border:none;border-radius:8px;padding:12px 24px;font-size:1rem;transition:background-color .3s}.PJv57W-download-button:disabled{cursor:not-allowed;background:#8e8e93}.PJv57W-download-button:hover:not(:disabled){background:#005bb5}.PJv57W-note{color:#666;min-height:20px;margin-top:10px;font-size:.85rem}";async function M(r,b){let v=await fetch(r);if(!v.ok)throw new Error(`HTTP error! status: ${v.status}`);let p=v.headers.get("Content-Length");if(!p)throw new Error("unable to get file size");let g=parseInt(p,10),J=v.body.getReader(),e=[],o=0;while(!0){let{done:x,value:t}=await J.read();if(x)break;e.push(t),o+=t.length;let G=o/g*100;b(G)}let d=new Uint8Array(o),W=0;for(let x of e)d.set(x,W),W+=x.length;return d.buffer}var O=(r)=>{return typeof r==="object"&&typeof r.filename==="string"&&typeof r.mimetype==="string"&&typeof r.data==="string"},Q=(r)=>{if(!O(r))throw new Error("无效的文件 JSON 数据！");let{data:b,filename:v,mimetype:p}=r,g=atob(b),J=Uint8Array.from(g,(W)=>W.charCodeAt(0)),e=new Blob([J],{type:p}),o=URL.createObjectURL(e),d=Object.assign(document.createElement("a"),{href:o,download:v,style:"display: none"});document.body.appendChild(d),d.click(),setTimeout(()=>{document.body.removeChild(d),URL.revokeObjectURL(o)},0)};var X=(r,b)=>{switch(b.type){case 0:return{progress:b.progress??0,note:`Downloading... ${b.progress?.toFixed(2)}%`,enableButton:!1};case 1:return{progress:100,note:"Parsing...",enableButton:!1};case 2:return{progress:100,note:"Completed!",enableButton:!0};case 3:return{progress:0,note:b.note??"error!",enableButton:!0};default:return r}},Y={progress:0,note:"",enableButton:!0},Z=I(({src:r,_key:b,filename:v})=>{let[p,g]=c(X,Y);N(()=>{return document.body.className=i,()=>{document.body.className=""}},[]);let J=P((o)=>{g({type:0,progress:o})},[]),e=P(async()=>{if(!r)throw new Error("unknown target file");g({type:0,progress:0}),M(r,J).then((o)=>{return g({type:1}),o}).then(async(o)=>{let d=new Blob([o]),W=URL.createObjectURL(d),x=await u(W,b);if(URL.revokeObjectURL(W),typeof x!=="string")throw new Error(String(x));let t=JSON.parse(x);Q(t)}).then(()=>{g({type:2})}).catch((o)=>{console.error(o);let d=o.message==="The operation failed for an operation-specific reason"?"invalid key!":o;g({type:3,note:d})})},[]);return n(q,{children:[f("title",{children:"File Download"}),f("style",{children:H}),n("div",{className:m,children:[f("div",{className:B,children:"Download File"}),f("div",{className:z,children:v||"unknown file"}),f("button",{className:w,onClick:e,disabled:!p.enableButton,children:"Download"}),f("div",{className:h,children:f("div",{className:k,style:{width:`${p.progress}%`}})}),f("div",{className:_,children:p.note})]})]})}),U=Z;export{U as default};
