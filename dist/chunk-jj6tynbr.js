import{f as G,h as m,i as H,k as I,o as Q,p as K,q as g,r as w,s as L,u as M}from"./chunk-ypwewzwb.js";import"./chunk-573s6t0s.js";Q();var t="PJv57W-body",z="PJv57W-container",h="PJv57W-download-button",_="PJv57W-filename",k="PJv57W-note",B="PJv57W-progress-bar",N="PJv57W-progress-bar-inner",q="PJv57W-title";var u=".PJv57W-body{color:#333;background-color:#f5f5f7;background-position:50%;background-repeat:no-repeat;background-size:cover;background-attachment:fixed;justify-content:center;align-items:center;height:100vh;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;display:flex}.PJv57W-container{text-align:center;background:#fff;border-radius:12px;max-width:600px;padding:20px;box-shadow:0 4px 10px #0000001a}.PJv57W-title{margin-bottom:20px;font-size:1.5rem}.PJv57W-filename{color:#555;word-wrap:break-word;margin-bottom:10px;font-size:1.2rem}.PJv57W-progress-bar{background:#e5e5e7;border-radius:5px;width:100%;height:10px;margin-top:20px;margin-bottom:20px;overflow:hidden}.PJv57W-progress-bar-inner{background:#007aff;width:0%;height:100%;transition:width .2s}.PJv57W-download-button{color:#fff;cursor:pointer;background:#007aff;border:none;border-radius:8px;padding:12px 24px;font-size:1rem;transition:background-color .3s}.PJv57W-download-button:disabled{cursor:not-allowed;background:#8e8e93}.PJv57W-download-button:hover:not(:disabled){background:#005bb5}.PJv57W-note{color:#666;min-height:20px;margin-top:10px;font-size:.85rem}";async function R(b,r){let v=await fetch(b);if(!v.ok)throw new Error(`HTTP error! status: ${v.status}`);let x=v.headers.get("Content-Length");if(!x)throw new Error("unable to get file size");let d=parseInt(x,10),P=v.body.getReader(),p=[],o=0,f="";while(!0){let{done:J,value:i}=await P.read();if(J)break;p.push(i),o+=i.length;let e=o/d*100;f+=e.toFixed(2)+`
`,r(e)}let W=new Uint8Array(o),n=0;for(let J of p)W.set(J,n),n+=J.length;return alert(f),W.buffer}var X=(b)=>{return typeof b==="object"&&typeof b.filename==="string"&&typeof b.mimetype==="string"&&typeof b.data==="string"},Y=(b)=>{if(!X(b))throw new Error("无效的文件 JSON 数据！");let{data:r,filename:v,mimetype:x}=b,d=atob(r),P=Uint8Array.from(d,(W)=>W.charCodeAt(0)),p=new Blob([P],{type:x}),o=URL.createObjectURL(p),f=Object.assign(document.createElement("a"),{href:o,download:v,style:"display: none"});document.body.appendChild(f),f.click(),setTimeout(()=>{document.body.removeChild(f),URL.revokeObjectURL(o)},0)};var Z=(b,r)=>{switch(r.type){case 0:return{progress:r.progress??0,note:`Downloading... ${r.progress?.toFixed(2)}%`,enableButton:!1};case 1:return{progress:100,note:"Parsing...",enableButton:!1};case 2:return{progress:100,note:"Completed!",enableButton:!0};case 3:return{progress:0,note:r.note??"error!",enableButton:!0};default:return b}},$={progress:0,note:"",enableButton:!0},E=G(({src:b,_key:r,filename:v})=>{let[x,d]=I(Z,$);H(()=>{return document.body.className=t,()=>{document.body.className=""}},[]);let P=m((o)=>{d({type:0,progress:o})},[]),p=m(async()=>{if(!b)throw new Error("unknown target file");d({type:0,progress:0}),R(b,P).then((o)=>{return d({type:1}),o}).then(async(o)=>{let f=new Blob([o]),W=URL.createObjectURL(f),n=await M(W);URL.revokeObjectURL(W);let J=await L(n,r),i=JSON.parse(J);Y(i)}).then(()=>{d({type:2})}).catch((o)=>{console.error(o),alert(o);let f=o.message==="The operation failed for an operation-specific reason"?"invalid key!":"failed to download!";d({type:3,note:f})})},[]);return w(K,{children:[g("title",{children:"File Download"}),g("style",{children:u}),w("div",{className:z,children:[g("div",{className:q,children:"Download File"}),g("div",{className:_,children:v||"unknown file"}),g("button",{className:h,onClick:p,disabled:!x.enableButton,children:"Download"}),g("div",{className:B,children:g("div",{className:N,style:{width:`${x.progress}%`}})}),g("div",{className:k,children:x.note})]})]})}),c=E;export{c as default};
