import{i as H,k as x,l as I,n as N,q as G,r as U,s as q,t as g,u as M}from"./chunk-sn5a9rvh.js";import"./chunk-mxn08kqf.js";G();var C="YMw3CW-body",i="YMw3CW-container",m="YMw3CW-download-button",t="YMw3CW-filename",h="YMw3CW-note",v="YMw3CW-progress-bar",_="YMw3CW-progress-bar-inner",k="YMw3CW-title";var u=".YMw3CW-body{color:#333;background-color:#f5f5f7;background-position:50%;background-repeat:no-repeat;background-size:cover;background-attachment:fixed;justify-content:center;align-items:center;height:100vh;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;display:flex}.YMw3CW-container{text-align:center;background:#fff;border-radius:12px;max-width:600px;padding:20px;box-shadow:0 4px 10px #0000001a}.YMw3CW-title{margin-bottom:20px;font-size:1.5rem}.YMw3CW-filename{color:#555;word-wrap:break-word;margin-bottom:10px;font-size:1.2rem}.YMw3CW-progress-bar{background:#e5e5e7;border-radius:5px;width:100%;height:10px;margin-top:20px;margin-bottom:20px;overflow:hidden}.YMw3CW-progress-bar-inner{background:#007aff;width:0%;height:100%;transition:width .2s}.YMw3CW-download-button{color:#fff;cursor:pointer;background:#007aff;border:none;border-radius:8px;padding:12px 24px;font-size:1rem;transition:background-color .3s}.YMw3CW-download-button:disabled{cursor:not-allowed;background:#8e8e93}.YMw3CW-download-button:hover:not(:disabled){background:#005bb5}.YMw3CW-note{color:#666;min-height:20px;margin-top:10px;font-size:.85rem}";var B=131072,K=async(r,e)=>{let w=(await fetch(r,{method:"HEAD"})).headers.get("Content-Length");if(!w)throw new Error("Failed to fetch file size.");let b=parseInt(w,10),f=0,n=[];for(let o=0;o<b;o+=B){let d=Math.min(o+B-1,b-1),Y=await(await fetch(r,{headers:{Range:`bytes=${o}-${d}`}})).arrayBuffer();n.push(Y),f+=Y.byteLength,e(f/b*100)}return new Blob(n).arrayBuffer()},O=(r)=>{return typeof r==="object"&&typeof r.filename==="string"&&typeof r.mimetype==="string"&&typeof r.data==="string"},Q=(r)=>{if(!O(r))throw new Error("无效的文件 JSON 数据！");let{data:e,filename:p,mimetype:w}=r,b=atob(e),f=Uint8Array.from(b,(W)=>W.charCodeAt(0)),n=new Blob([f],{type:w}),o=URL.createObjectURL(n),d=Object.assign(document.createElement("a"),{href:o,download:p,style:"display: none"});document.body.appendChild(d),d.click(),setTimeout(()=>{document.body.removeChild(d),URL.revokeObjectURL(o)},0)};var R=(r,e)=>{switch(e.type){case 0:return{progress:e.progress??0,note:`Downloading... ${e.progress?.toFixed(2)}%`,enableButton:!1};case 1:return{progress:100,note:"Parsing...",enableButton:!1};case 2:return{progress:100,note:"Completed!",enableButton:!0};case 3:return{progress:0,note:e.note??"error!",enableButton:!0};default:return r}},X={progress:0,note:"",enableButton:!0},Z=H(({src:r,_key:e,filename:p})=>{let[w,b]=N(R,X);I(()=>{return document.body.className=C,()=>{document.body.className=""}},[]);let f=x((o)=>{b({type:0,progress:o})},[]),n=x(async()=>{if(!r)throw new Error("unknown target file");b({type:0,progress:0}),K(r,f).then((o)=>{return b({type:1}),U(new Uint8Array(o),e)}).then((o)=>{let d=JSON.parse(o);Q(d),b({type:2})}).catch((o)=>{console.error(o);let d=o.message==="The operation failed for an operation-specific reason"?"invalid key!":"failed to download!";b({type:3,note:d})})},[]);return M(q,{children:[g("title",{children:"File Download"}),g("style",{children:u}),M("div",{className:i,children:[g("div",{className:k,children:"Download File"}),g("div",{className:t,children:p||"unknown file"}),g("button",{className:m,onClick:n,disabled:!w.enableButton,children:"Download"}),g("div",{className:v,children:g("div",{className:_,style:{width:`${w.progress}%`}})}),g("div",{className:h,children:w.note})]})]})}),V=Z;export{V as default};
